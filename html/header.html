<!-- header styles are included in merge.css -->

<nav class="site-nav">
    <a class="brand" href="index.html"><img src="../pictures/logo_1.png" alt="EchoBeads" style="height:36px;"> <span>EchoBeads</span></a>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="review.html">Review</a></li>
    </ul>

    <div style="position:relative">
        <button id="cart-button" class="cart-btn" aria-expanded="false" aria-haspopup="true" title="Open cart" aria-controls="cart-dropdown" tabindex="0">
            ðŸ›’ Cart
            <span id="cart-count" class="cart-count" aria-live="polite">0</span>
        </button>

        <div id="cart-dropdown" class="cart-dropdown" role="dialog" aria-label="Shopping cart">
            <div class="items" id="cart-items">Empty cart</div>
            <div class="actions">
                <a href="cart.html">View Cart</a>
                <button id="clear-cart">Clear</button>
            </div>
        </div>
    </div>
</nav>

<script>
    // Simple cart stored in localStorage under key 'echobeads_cart'
    (function(){
        const KEY = 'echobeads_cart';

        // create toast container
        const toast = document.createElement('div'); toast.className='toast'; toast.id='site-toast'; toast.textContent=''; document.body.appendChild(toast);

        function getCart(){
            try{ return JSON.parse(localStorage.getItem(KEY) || '[]') }catch(e){ return [] }
        }

        function saveCart(cart){ localStorage.setItem(KEY, JSON.stringify(cart)); updateBadge(); }

        function updateBadge(){
            const countEl = document.getElementById('cart-count');
            if(!countEl) return;
            const cart = getCart();
            const total = cart.reduce((s,i)=> s + (i.qty||0), 0);
            countEl.textContent = total;
        }

        function renderDropdown(){
            const wrap = document.getElementById('cart-items');
            const cart = getCart();
            if(!wrap) return;
            if(cart.length===0){ wrap.innerHTML = '<div style="padding:12px;color:#666">Your cart is empty.</div>'; return }
            wrap.innerHTML = '';
            cart.forEach(item=>{
                const div = document.createElement('div'); div.className='item';
                div.innerHTML = `<img src="${item.image||'../pictures/logo_1.png'}" alt="${item.name}"><div style="flex:1"><div style="font-weight:600">${item.name}</div><div style="color:#666">${item.qty} Ã— $${item.price}</div></div><div style="font-weight:700">$${(item.price*item.qty).toFixed(2)}</div>`;
                wrap.appendChild(div);
            })
        }

        // public API
        window.addToCart = function(item){
            const cart = getCart();
            const found = cart.find(i=> i.id === item.id);
            if(found){ found.qty = (found.qty||1) + (item.qty||1) }
            else cart.push(Object.assign({qty:1}, item));
            saveCart(cart);
            renderDropdown();
            // show toast
            const t = document.getElementById('site-toast'); if(t){ t.textContent = `${item.name} added to cart`; t.classList.add('show'); setTimeout(()=> t.classList.remove('show'),1600); }
        }

        window.removeFromCart = function(id){
            const cart = getCart().filter(i=> i.id !== id);
            saveCart(cart); renderDropdown();
        }

        // UI events
        document.addEventListener('click', function(e){
            const btn = document.getElementById('cart-button');
            const dd = document.getElementById('cart-dropdown');
            if(!btn || !dd) return;
            if(btn.contains(e.target)){
                const open = dd.classList.toggle('open');
                btn.setAttribute('aria-expanded', String(open));
                renderDropdown();
                return;
            }
            if(!dd.contains(e.target)){
                dd.classList.remove('open');
                btn.setAttribute('aria-expanded','false');
            }
        });

        // keyboard toggle for cart (Enter/Space)
        document.getElementById('cart-button').addEventListener('keydown', function(e){
            if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); this.click(); }
        });

        // highlight active nav link
        (function highlightActive(){
            try{
                const path = location.pathname.split('/').pop() || 'index.html';
                document.querySelectorAll('.site-nav a').forEach(a=>{
                    if(a.getAttribute('href') === path) a.style.textDecoration='underline';
                });
            }catch(e){}
        })();

        document.getElementById('clear-cart').addEventListener('click', function(){ localStorage.removeItem(KEY); renderDropdown(); updateBadge(); });

        // initial badge
        updateBadge();
        // when storage changes in other tabs
        window.addEventListener('storage', updateBadge);
    })();
</script>