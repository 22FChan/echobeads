<!-- header styles are included in merge.css -->

<nav class="site-nav">
    <a class="brand" href="index.html"><img src="../pictures/logo_1.png" alt="EchoBeads" style="height:36px;"> <span>EchoBeads</span></a>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="review.html">Review</a></li>
    </ul>

    <div style="position:relative">
        <button id="cart-button" class="cart-btn" aria-expanded="false" aria-haspopup="true" title="Open cart" aria-controls="cart-dropdown" tabindex="0">
            ðŸ›’ Cart
            <span id="cart-count" class="cart-count" aria-live="polite">0</span>
        </button>

                <!-- drawer overlay + drawer (initially hidden) -->
                <div id="cart-drawer-overlay" class="cart-drawer-overlay" tabindex="-1"></div>
                <aside id="cart-drawer" class="cart-drawer" role="dialog" aria-label="Cart drawer" aria-hidden="true">
                    <div class="drawer-header">Your cart</div>
                    <div class="drawer-items" id="drawer-items">No items</div>
                    <div class="drawer-footer">
                        <div id="drawer-total">Total: Â£0.00</div>
                        <div>
                            <a class="btn" href="cart.html">View Cart</a>
                            <button id="drawer-clear" class="btn">Clear</button>
                        </div>
                    </div>
                </aside>
    </div>
</nav>

<script>
    // Simple cart stored in localStorage under key 'echobeads_cart'
    (function(){
        const KEY = 'echobeads_cart';

        // create toast container
        const toast = document.createElement('div'); toast.className='toast'; toast.id='site-toast'; toast.textContent=''; document.body.appendChild(toast);

        function getCart(){
            try{ return JSON.parse(localStorage.getItem(KEY) || '[]') }catch(e){ return [] }
        }

    function saveCart(cart){ localStorage.setItem(KEY, JSON.stringify(cart)); updateBadge(); window.dispatchEvent(new Event('storage')); }

        function updateBadge(){
            const countEl = document.getElementById('cart-count');
            if(!countEl) return;
            const cart = getCart();
            const total = cart.reduce((s,i)=> s + (i.qty||0), 0);
            countEl.textContent = total;
        }

        function renderDrawer(){
            const wrap = document.getElementById('drawer-items');
            const totalEl = document.getElementById('drawer-total');
            const cart = getCart();
            if(!wrap) return;
            if(cart.length===0){ wrap.innerHTML = '<div style="padding:12px;color:#666">Your cart is empty.</div>'; totalEl.textContent = 'Total: Â£0.00'; return }
            wrap.innerHTML = '';
            let total = 0;
            cart.forEach(item=>{
                total += item.price * item.qty;
                const div = document.createElement('div'); div.className='item';
                div.innerHTML = `<img src="${item.image||'../pictures/logo_1.png'}" alt="${item.name}"><div style="flex:1"><div style="font-weight:600">${item.name}</div><div style="color:#666">${item.qty} Ã— Â£${item.price}</div></div><div style="font-weight:700">Â£${(item.price*item.qty).toFixed(2)}</div>`;
                wrap.appendChild(div);
            })
            totalEl.textContent = 'Total: Â£' + total.toFixed(2);
        }

        // public API
        window.addToCart = function(item){
            const cart = getCart();
            const found = cart.find(i=> i.id === item.id);
            if(found){ found.qty = (found.qty||1) + (item.qty||1) }
            else cart.push(Object.assign({qty:1}, item));
            saveCart(cart);
            renderDrawer();
            // show toast
            const t = document.getElementById('site-toast'); if(t){ t.textContent = `${item.name} added to cart`; t.classList.add('show'); setTimeout(()=> t.classList.remove('show'),1600); }
        }

        window.removeFromCart = function(id){
            const cart = getCart().filter(i=> i.id !== id);
            saveCart(cart); renderDrawer();
        }

        // UI events - toggle drawer
        document.addEventListener('click', function(e){
            const btn = document.getElementById('cart-button');
            const overlay = document.getElementById('cart-drawer-overlay');
            const drawer = document.getElementById('cart-drawer');
            if(!btn || !drawer || !overlay) return;
            if(btn.contains(e.target)){
                const open = !drawer.classList.contains('open');
                drawer.classList.toggle('open', open);
                overlay.classList.toggle('open', open);
                drawer.setAttribute('aria-hidden', String(!open));
                btn.setAttribute('aria-expanded', String(open));
                if(open) renderDrawer();
                return;
            }
            if(overlay.contains(e.target)){
                drawer.classList.remove('open'); overlay.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); btn.setAttribute('aria-expanded','false');
            }
        });

        // keyboard support
        document.getElementById('cart-button').addEventListener('keydown', function(e){
            if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); this.click(); }
        });

        // highlight active nav link
        (function highlightActive(){ try{ const path = location.pathname.split('/').pop() || 'index.html'; document.querySelectorAll('.site-nav a').forEach(a=>{ if(a.getAttribute('href') === path) a.style.textDecoration='underline'; }); }catch(e){} })();

    // clear handlers
    const clearBtn = document.getElementById('clear-cart'); if(clearBtn) clearBtn.addEventListener('click', function(){ saveCart([]); renderDrawer(); });
    const drawerClear = document.getElementById('drawer-clear'); if(drawerClear) drawerClear.addEventListener('click', function(){ saveCart([]); renderDrawer(); });

        // initial badge
        updateBadge();
        // when storage changes in other tabs
        window.addEventListener('storage', updateBadge);
    })();
</script>